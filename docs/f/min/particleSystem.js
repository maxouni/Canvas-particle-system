"use strict";var particle=function(t,i,a,s,e,h){this.color=i[Math.floor(Math.random()*i.length)],this.type=e<100?a[Math.floor(Math.random()*a.length)]:a[2],this._images=h,this.canvasParam=s,this.canvasCtx=t,this.canvasCtx&&(this.positionX=parseInt(Math.random()*this.canvasParam.width,10),this.positionY=parseInt(Math.random()*this.canvasParam.height,10),this.speed=.2*Math.random(),this.width=0,this.height=0,this.radius=7*Math.random(),this.angle=(1+2*Math.random())*Math.PI/2,this.vectorEndActivity={},this.alphaLimit=Math.random(),this.alpha=0,this.alphaDir=1,this.easingRepulse=!0,this._init())};particle.prototype._init=function(){this.radius=0,this.width=this._randomInteger(20,40)},particle.prototype.setPosition=function(){this.positionX=parseInt(Math.random()*this.canvasParam.width,10),this.positionY=parseInt(Math.random()*this.canvasParam.height,10),this.speed=.1*Math.random(),this.width=this._randomInteger(8,40),this.height=2*Math.random()+2,this.radius=7*Math.random(),this.angle=(1+2*Math.random())*Math.PI/2,this._render()},particle.prototype._render=function(){this.canvasCtx.beginPath(),this.canvasCtx.globalAlpha=this.alpha,this.canvasCtx.drawImage(this._images[this.type],this.positionX,this.positionY,this.width,this.width),this.canvasCtx.closePath()},particle.prototype.animate=function(){this.positionX+=this.speed*Math.cos(this.angle-Math.PI/2),this.positionY+=this.speed*Math.sin(this.angle-Math.PI/2),this.alpha+=.005*this.alphaDir,this.alpha>1&&(this.alpha=1,this.alphaDir=-1),this.alpha<=this.alphaLimit&&(this.alphaDir=1,this.alpha=this.alphaLimit),this._render()},particle.prototype._randomInteger=function(t,i){var a=t+Math.random()*(i-t);return a=Math.round(a)},particle.prototype.fixPosition=function(){this.vectorEndActivity={ax:0,ay:0,bx:this.positionX-this.canvasParam.width/2,by:this.positionY-this.canvasParam.height/2,length:0,endX:this.positionX,endY:this.positionY},this.vectorEndActivity.length=Math.sqrt(Math.pow(Math.abs(this.vectorEndActivity.bx),2)+Math.pow(Math.abs(this.vectorEndActivity.by),2))},particle.prototype.animateRePulse=function(t){if(this.radius=t,0!=this.radius){this.timeStartRepulse||(this.timeStartRepulse=window.performance.now()),this.vectorEndActivity.endX>this.canvasParam.width/2?this.positionX=t+this.vectorEndActivity.endX:this.positionX=this.vectorEndActivity.endX-t,this.vectorEndActivity.endY>this.canvasParam.height/2?this.positionY=this.vectorEndActivity.endY+t:this.positionY=this.vectorEndActivity.endY-t;var i=Math.random();if(this.positionY=parseInt(this.positionY,10),this.positionX=parseInt(this.positionX,10),this.easingRepulse){var a=window.performance.now()-this.timeStartRepulse;this.positionX+=Math.easeInOutQuart(1,a,0,2,1e3),this.positionY+=Math.easeInOutQuart(1,a,0,2,1e3)}this.width+=i,this.height+=i,this.alpha-=.02,this.alpha>=0&&this._render()}},particle.prototype.animateDestroy=function(){this.radius-=1,this.radius>0&&(this.width=this.radius,this._render())},particle.prototype.animateShow=function(){this.positionX+=this.speed*Math.cos(this.angle-Math.PI/2),this.positionY+=this.speed*Math.sin(this.angle-Math.PI/2),this.alpha+=.02,this.alpha>1?(this.alpha=1,this.alphaDir=-1):this._render()},app.factory("particleCloud",function(t,i,a,s){var e=function(t){this.canvas=t,this.canvas&&(this.img={circle_green:new Image,circle_red:new Image,circle_white:new Image},this.canvasCtx=t.getContext("2d"),this.canvasParam={width:t.clientWidth,height:t.clientHeight},this.arColor=["#cd3933","#fff","#6bcd2c"],this.arType=["circle_green","circle_red","circle_white"],this.radiusPulse=0,this.animateId=0,this.countParticles=200,this.particles={},this._counter=0,this._deffered=null,this._repulse=!1,this.init())};return e.prototype={init:function(){var i=this;this.img.circle_green.src="f/media/global/particle/circle_green.png",this.img.circle_white.src="f/media/global/particle/circle_white.png",this.img.circle_red.src="f/media/global/particle//circle_red.png",t(function(){i._onResize();for(var t=0;t<i.countParticles;t++)i.particles[t]=new particle(i.canvasCtx,i.arColor,i.arType,i.canvasParam,t,i.img);angular.element(a).bind("resize",function(){i._onResize()})})},reGather:function(){if(!this._repulse){this.canvasCtx.clearRect(0,0,this.canvasParam.width,this.canvasParam.height);for(var t in this.particles)this.particles[t].canvasParam.width=this.canvasParam.width,this.particles[t].canvasParam.height=this.canvasParam.height,this.particles[t].setPosition()}},startDraw:function(){this.animateId&&cancelAnimationFrame(this.animateId),this.animateId=requestAnimationFrame(angular.bind(this,this.animateDraw))},stopDraw:function(){this.animateId&&cancelAnimationFrame(this.animateId)},showAll:function(){return this.animateId&&cancelAnimationFrame(this.animateId),this.animateId=0,this._counter=0,this._deffered=s.defer(),this.animateId=requestAnimationFrame(angular.bind(this,this.animateShow)),this._deffered.promise},destroyAll:function(){return this.animateId&&cancelAnimationFrame(this.animateId),this.animateId=0,this._counter=40,this._deffered=s.defer(),this.animateId=requestAnimationFrame(angular.bind(this,this.animateDestroy)),this._deffered.promise},repulse:function(){this._defferedRepulse=s.defer(),this.animateId&&cancelAnimationFrame(this.animateId),this.animateId=0;for(var t in this.particles)this.particles[t].fixPosition();return this._radiusMax=Math.sqrt(Math.pow(this.canvasParam.width/2,2)+Math.pow(this.canvasParam.height/2,2)),this.animateRepulseId=requestAnimationFrame(angular.bind(this,this.animateRePulse)),this._defferedRepulse.promise},animateDraw:function(){var t=this;this.canvasCtx.clearRect(0,0,this.canvasParam.width,this.canvasParam.height);for(var i in this.particles)this.particles[i].animate();t.animateId=requestAnimationFrame(angular.bind(t,t.animateDraw))},animateShow:function(){this.canvasCtx.clearRect(0,0,this.canvasParam.width,this.canvasParam.height),this._counter++;for(var t in this.particles)this.particles[t].animateShow(this._counter);this._counter<50?this.animateId=requestAnimationFrame(angular.bind(this,this.animateShow)):(this._deffered.resolve(),this.animateId&&cancelAnimationFrame(this.animateId))},animateDestroy:function(){this.canvasCtx.clearRect(0,0,this.canvasParam.width,this.canvasParam.height),this._counter--;for(var t in this.particles)this.particles[t].animateDestroy();this._counter>0?this.animateId=requestAnimationFrame(angular.bind(this,this.animateDestroy)):(this._deffered.resolve(),this.animateId&&cancelAnimationFrame(this.animateId))},animateRePulse:function(){this.canvasCtx.clearRect(0,0,this.canvasParam.width,this.canvasParam.height);for(var t in this.particles)this.particles[t].animateRePulse(this.radiusPulse);this._radiusMax<=this.radiusPulse?(this.animateRepulseId&&cancelAnimationFrame(this.animateRepulseId),this.animateId=0,this.canvasCtx.clearRect(0,0,this.canvasParam.width,this.canvasParam.height),this._defferedRepulse.resolve(),this._repulse=!0):(this.radiusPulse+=parseInt(this._radiusMax/50,10),this.animateRepulseId=requestAnimationFrame(angular.bind(this,this.animateRePulse)))},_onResize:function(){this.canvasParam={width:window.innerWidth,height:window.innerHeight},this.canvas.width=this.canvasParam.width,this.canvas.height=this.canvasParam.height,this.reGather()}},e});